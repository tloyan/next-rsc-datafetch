# useActionState : Validation Serveur

### ğŸ’¡ Comprendre `useActionState` et la validation Serveur

## ğŸ“ Tes notes

DÃ©taille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Comme il est courant dâ€™utiliser les serveurs action avec un formulaire, il y a un nouveau `Hook React` assez utile pour gÃ©rer lâ€™Ã©tat du formulaire : **`useActionState`**

**`useActionState`** est un Hook qui vous permet de mettre Ã  jour l'Ã©tat en fonction du rÃ©sultat d'une action de formulaire.

```tsx
import {useActionState} from 'react'
import {action} from './actions.js'

function MyComponent() {
  const [state, formAction] = useActionState(action, null)
  // ...
  return <form action={formAction}>{/* ... */}</form>
}
```

Note : lâ€™action prend 2 paramÃ¨tres : un `state` et le `FormData`

Ce Hook va de pair avec `useformStatus` qui permet dâ€™obtenir le statut du formulaire.

```tsx
//SI
type ActionStateType = {success: boolean}
const [state, formAction] = useActionState(action, {success: false} )

//ALORS action aura 2 paramÃ¨tres
export async function onSubmitAction(
  prevState: ActionStateType ,
  data: FormData
  ...
```

```tsx
function Submit() {
  const status = useFormStatus()
  return <button disabled={status.pending}>Submit</button>
}

export default function App() {
  return (
    <form action={action}>
      <Submit />
    </form>
  )
}
```

ğŸ“‘ Le lien vers la doc [https://react.dev/reference/react/useActionState#usage](https://react.dev/reference/react/useActionState#usage)

## Exercice

Dans les exercices prÃ©cÃ©dents, `React Hook Form` s'occupait de gÃ©rer lâ€™Ã©tat et soumettre le formulaire Ã  lâ€™action. Nous voulons maintenant profiter de `useActionState` et `useFormStatus` de React nativement.

ğŸ‘¨â€âœˆï¸ Hugo, le Chef de projet, te demande de dÃ©sactiver la validation `Zod` client car non Safe et de lâ€™ajouter cÃ´tÃ© server action.

Nous avons supprimÃ© tous les liens Ã  `React Hook Form` pour simplifier lâ€™exercice pour revenir Ã  un formulaire non contrÃ´lÃ©.

```tsx
<form ref={formRef} className="gap-2 space-y-4">
  <Label>Product title</Label>
  <Input placeholder="ex : Iphone" name="title" />
  <Label>Product title</Label>
  <Input type="number" placeholder="199" name="price" />
  <Label>Product title</Label>
  <Textarea placeholder="Product description" name="description" />
  <Label>Product title</Label>
  <Select name="category">
    <SelectTrigger>
      <SelectValue placeholder="Choisir une catÃ©gorie" />
    </SelectTrigger>

    <SelectContent>
      {categories.map((category) => (
        <SelectItem key={category} value={category}>
          {category}
        </SelectItem>
      ))}
    </SelectContent>
  </Select>
  <Label>Product title</Label>
  <Input type="number" placeholder="Product quantity" name="quantity" />
  <div className="flex gap-2">
    <Button size="sm" type="submit">
      Save
    </Button>
    <Button size="sm" variant="outline">
      Cancel
    </Button>
  </div>
</form>
```

**ğŸ¶** Dans cet exercice, tu vas devoir adapter le formulaire en soumettant via `useActionState` .

ğŸ¶ Tu vas Ã©galement devoir faire une validation cÃ´tÃ© serveur avec `Zod` et afficher un message dâ€™erreur (`toast`) dans le `form`

Pense Ã  reset le formulaire aprÃ¨s ajout.

Fichiers

- `exercises/shop-admin/form/use-action-state.tsx`
- `exercises/shop-admin/actions.tsx`

## Bonus

### 1. ğŸš€ Supprimer des champs de la validation Zod

Nous envoyons bien les donnÃ©es du formulaire au server action, cependant, la validation est trop stricte. Beaucoup de champs ne sont pas dans le `FormData` comme lâ€™`id`, `updatedAt` etc â€¦ Ils pourraient Ãªtre ajoutÃ©s en champs `hidden` mais nous ne voulons pas avoir Ã  gÃ©rer cela dans le `form`.

```tsx
<form action={formAction} ref={formRef} className="gap-2 space-y-4">
      <input type="hidden" name="id" value={product?.id} />
```

Nous allons rendre optionnels certains champs de la validation (sans changer le schÃ©ma original `formSchema`). Pour cela, nous allons utiliser `zod.partial`

ğŸ“‘ [https://zod.dev/?id=partial](https://zod.dev/?id=partial)

Exemple qui rend `email` optionnel sur un type `user`

```tsx
const optionalEmail = user.partial({
  email: true,
})
```

ğŸ¶ Dans cet exercice, tu vas devoir crÃ©er un nouveau type `formSchemaLight` Ã  partir de `formSchema` qui rend les champs `id` et `createdAt` optionnels.

Fichiers

- `exercises/shop-admin/actions.tsx`

### 2. ğŸš€ useFormStatus

ğŸ‘¨â€âœˆï¸ Hugo, le chef de projet, demande de dÃ©sactiver le bouton `Save` lors que le soumission du formulaire.

ğŸ¶ Utilise le Hook `useFormStatus` pour gÃ©rer le statut `pending` du formulaire.

**ğŸ¤–** `const status = useFormStatus()`

Note : `useFormStatus` fonctionne dans un composant `Children` oÃ¹ se situe le `useActionState` .

- CrÃ©e un composant `<Buttons />` contentant les 2 boutons et gÃ©rant le statut.

Fichiers

- `exercises/shop-admin/form/use-action-state.tsx`

## Aller plus loin

ğŸ“‘ Le lien vers la doc [https://www.w3schools.com/html/html_css.asp](https://www.w3schools.com/html/html_css.asp)

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent_
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va t'aider sur les spÃ©cifications du projet_

## ğŸœ Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20PRO&entry.1430994900=03.RSC%20Data%20fetch&entry.533578441=08%20useActionState%20Server%20validation).
